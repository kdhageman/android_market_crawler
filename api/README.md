# API

##### Prepare account database
In case of Play Store, a separate web server must be run before running the spiders.
This web server acts as a HTTP wrapper around an external (gRPC) Play Store API.

Before doing so, a local `sqlite` database must be populated with Android accounts, including the `auth sub token` obtained after logging in with an email and password. 
This is done as follows:
```
$ python api/login.py --help
usage: Script to populate sqlite database with Android credentials [-h] --android-id ANDROID_ID [--sqlite-file SQLITE_FILE] [--config CONFIG] [--proxies_file PROXIES_FILE]

optional arguments:
  -h, --help            show this help message and exit
  --android-id ANDROID_ID
                        ID of Android device
  --sqlite-file SQLITE_FILE
                        Path to sqlite database
  --config CONFIG       Path to YAML configuration file
  --proxies_file PROXIES_FILE
                        Path to file of proxy addresses
```

##### Starting the API

Set a few environment variables:
- `ANDROID_ID` - ID of Android device
- `ACCOUNT_DB` - Path to account db (generated by `login.py` script)
- `PROXIES_FILE` - Path of file with HTTP proxy servers to use

The following command starts the web server on port `5000` with 4 workers:
```
$ gunicorn --workers 4 --bind 0.0.0.0:5000 api.api:app
```